[gd_scene load_steps=31 format=2]

[ext_resource path="res://Assets/Art/Main Characters/Virtual Guy/Jump (32x32).png" type="Texture" id=1]
[ext_resource path="res://Assets/Art/Main Characters/Virtual Guy/Fall (32x32).png" type="Texture" id=2]
[ext_resource path="res://Assets/Art/Main Characters/Virtual Guy/Idle (32x32).png" type="Texture" id=3]
[ext_resource path="res://Assets/Art/Main Characters/Virtual Guy/Run (32x32).png" type="Texture" id=4]

[sub_resource type="GDScript" id=26]
script/source = "extends KinematicBody2D


# Used to keep track of the direction of gravityorgo
enum GRAV {
	DOWN,
	UP,
	LEFT,
	RIGHT
}

export var playerSpeed : float = 200
export var gravityForce : float =  35
export var jumpForce : float = 500

var gravityDir = GRAV.DOWN 
var gravity : Vector2 = Vector2.UP
var velocity = Vector2.ZERO
var normal_vector = Vector2.DOWN
var jumpVec : Vector2 = Vector2.ZERO

var gravDir_to_gravity = {
	GRAV.DOWN : Vector2.DOWN,
	GRAV.UP : Vector2.UP,
	GRAV.LEFT : Vector2.LEFT,
	GRAV.RIGHT : Vector2.RIGHT
} 




onready var sprite = $AnimatedSprite

func _ready() -> void:
	sprite.play(\"Idle\")


func _physics_process(delta: float) -> void:
	_set_grav_vars()
	_move()
	
func _process(delta: float) -> void:
	_handle_anim()
	_handle_velocity()
	_handle_gravity_input()


func _handle_gravity_input() -> void:
	# Set the state of gravity based on user input
	if Input.is_action_pressed(\"Grav_left\"):
		gravityDir = GRAV.LEFT
	elif Input.is_action_pressed(\"Grav_right\"):
		gravityDir = GRAV.RIGHT
	elif Input.is_action_pressed(\"Grav_up\"):
		gravityDir = GRAV.UP
	elif Input.is_action_pressed(\"Grav_down\"):
		gravityDir = GRAV.DOWN

		


func _handle_velocity() -> void:
	if(gravityDir == GRAV.DOWN || gravityDir == GRAV.UP):
		_handle_Up_Down_Velocity()
	else:
		_handle_Left_Right_Velocity()
		
	if Input.is_action_just_pressed(\"Jump\") && is_on_floor():
		_jump()
		
func _handle_anim() -> void:
	# Handle the state of the animation
	if(gravityDir == GRAV.DOWN || gravityDir == GRAV.UP):
		_handle_Up_Down_Anim()
	else:
		_handle_Left_Right_Anim()
		
	
	if Input.is_action_just_pressed(\"Up\") && is_on_floor():
		sprite.play(\"Jump\")
		
	if !is_on_floor() && _is_falling():
		sprite.play(\"Fall\")
	
	# Rotate the sprite to match gravity orientation 
	# TODO add tween
	match gravityDir:
		GRAV.DOWN:
			sprite.rotation = 0
		GRAV.UP:
			sprite.rotation = PI
		GRAV.RIGHT:
			sprite.rotation = -PI/2
		GRAV.LEFT:
			sprite.rotation = PI/2

		
func _set_grav_vars() -> void:
	# Use the gravity value to set the normal, direction of gravity, jump force, etc.
	gravity = gravDir_to_gravity[gravityDir]
	normal_vector = gravity * -1 # Normal is opposite of gravity direction
	
func _move() -> void:
	# Move the character
	velocity += gravity * gravityForce # TODO make gravity a vector, create a dict that maps enum of grav direction to vector of gravity
	velocity = move_and_slide(velocity, normal_vector)

func _is_falling() -> bool:
	# Check if the character is falling relative to the  gravity direction
	return false 
	
func _jump() -> void:
	match gravityDir:
		GRAV.DOWN:
			velocity.y = -jumpForce
		GRAV.UP:
			velocity.y = jumpForce
		GRAV.RIGHT:
			velocity.x = -jumpForce
		GRAV.LEFT:
			velocity.x = jumpForce
			
func _handle_Up_Down_Velocity() -> void:
	
	# Handle Input that impacts velocity
	if Input.is_action_pressed(\"Left\"):

		velocity.x = -playerSpeed # TODO will need to make player speed a vector
	elif Input.is_action_pressed(\"Right\"):

		velocity.x = playerSpeed
	else:
		
		velocity.x = 0
		
func _handle_Left_Right_Velocity() -> void:
	
	# Handle Input that impacts velocity
	if Input.is_action_pressed(\"Up\"):

		velocity.y = -playerSpeed # TODO will need to make player speed a vector
	elif Input.is_action_pressed(\"Down\"):

		velocity.y = playerSpeed
	else:
		
		velocity.y = 0
		

func _handle_Left_Right_Anim() -> void:
	if Input.is_action_pressed(\"Up\"):
		sprite.play(\"Run\")
		sprite.flip_h = (gravityDir == GRAV.LEFT)
	elif Input.is_action_pressed(\"Down\"):
		sprite.play(\"Run\")
		sprite.flip_h = !(gravityDir == GRAV.LEFT)
	else:
		sprite.play(\"Idle\")
		
func _handle_Up_Down_Anim() -> void:
	if Input.is_action_pressed(\"Left\"):
		sprite.play(\"Run\")
		sprite.flip_h = (gravityDir == GRAV.DOWN)
	elif Input.is_action_pressed(\"Right\"):
		sprite.play(\"Run\")
		sprite.flip_h = !(gravityDir == GRAV.DOWN)
	else:
		sprite.play(\"Idle\")
		



"

[sub_resource type="AtlasTexture" id=13]
atlas = ExtResource( 4 )
region = Rect2( 0, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=14]
atlas = ExtResource( 4 )
region = Rect2( 32, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=15]
atlas = ExtResource( 4 )
region = Rect2( 64, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=16]
atlas = ExtResource( 4 )
region = Rect2( 96, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=17]
atlas = ExtResource( 4 )
region = Rect2( 128, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=18]
atlas = ExtResource( 4 )
region = Rect2( 160, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=19]
atlas = ExtResource( 4 )
region = Rect2( 192, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=20]
atlas = ExtResource( 4 )
region = Rect2( 224, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=21]
atlas = ExtResource( 4 )
region = Rect2( 256, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=22]
atlas = ExtResource( 4 )
region = Rect2( 288, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=23]
atlas = ExtResource( 4 )
region = Rect2( 320, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=24]
atlas = ExtResource( 4 )
region = Rect2( 352, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=1]
atlas = ExtResource( 3 )
region = Rect2( 0, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=2]
atlas = ExtResource( 3 )
region = Rect2( 32, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=3]
atlas = ExtResource( 3 )
region = Rect2( 64, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=4]
atlas = ExtResource( 3 )
region = Rect2( 96, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=5]
atlas = ExtResource( 3 )
region = Rect2( 128, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=6]
atlas = ExtResource( 3 )
region = Rect2( 160, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=7]
atlas = ExtResource( 3 )
region = Rect2( 192, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=8]
atlas = ExtResource( 3 )
region = Rect2( 224, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=9]
atlas = ExtResource( 3 )
region = Rect2( 256, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=10]
atlas = ExtResource( 3 )
region = Rect2( 288, 0, 32, 32 )

[sub_resource type="AtlasTexture" id=11]
atlas = ExtResource( 3 )
region = Rect2( 320, 0, 32, 32 )

[sub_resource type="SpriteFrames" id=12]
animations = [ {
"frames": [ SubResource( 13 ), SubResource( 14 ), SubResource( 15 ), SubResource( 16 ), SubResource( 17 ), SubResource( 18 ), SubResource( 19 ), SubResource( 20 ), SubResource( 21 ), SubResource( 22 ), SubResource( 23 ), SubResource( 24 ) ],
"loop": true,
"name": "Run",
"speed": 20.0
}, {
"frames": [ ExtResource( 1 ) ],
"loop": false,
"name": "Jump",
"speed": 5.0
}, {
"frames": [ ExtResource( 2 ) ],
"loop": false,
"name": "Fall",
"speed": 5.0
}, {
"frames": [ SubResource( 1 ), SubResource( 2 ), SubResource( 3 ), SubResource( 4 ), SubResource( 5 ), SubResource( 6 ), SubResource( 7 ), SubResource( 8 ), SubResource( 9 ), SubResource( 10 ), SubResource( 11 ) ],
"loop": true,
"name": "Idle",
"speed": 15.0
} ]

[sub_resource type="CapsuleShape2D" id=25]
radius = 9.0
height = 4.0

[node name="Player" type="KinematicBody2D"]
position = Vector2( 69, 25 )
script = SubResource( 26 )

[node name="AnimatedSprite" type="AnimatedSprite" parent="."]
frames = SubResource( 12 )
animation = "Idle"
frame = 1

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( 0, 4 )
shape = SubResource( 25 )
